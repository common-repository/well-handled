(function(){new Vue({el:"#vue-search",data:window.whData,methods:{lastSearch:0,searchSubmit:function(){var t=this;this.forms.search.errors={},this.forms.search.loading=!0,this.formAjax(this.forms.search,function(e){t.forms.search.loading=!1,t.searched=!0,t.showingBar="",t.showingClicks="",e.ok&&e.data?(t.stats=e.data.stats,t.ranged=e.data.ranged,t.date_min=e.data.date_min,t.date_max=e.data.date_max,t.hasStats=0<t.stats.sent.total,t.hasClicks=0<t.stats.clicks.total,t.ranged||(0<t.stats.volume.this_month.labels.length?t.showBar("this_month"):0<t.stats.volume.this_year.labels.length?t.showBar("this_year"):1<t.stats.volume.years.labels.length&&t.showBar("years")),t.hasClicks&&(0<t.stats.clicks.template.length?t.showingClicks="template":0<t.stats.clicks.subject.length?t.showingClicks="subject":0<t.stats.clicks.domain.length?t.showingClicks="domain":0<t.stats.clicks.url.length&&(t.showingClicks="url"))):e.errors?t.forms.search.errors=e.errors:t.forms.search.errors.other="The server garbled the last response. :(",t.scrollTo()})},showBar:function(t){this.showingBar=t,Vue.nextTick(function(){var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)})}},mounted:function(){this.searchSubmit()}}),Vue.component("chartist",{template:'<div ref="chart" :class="[ratio, noData]" v-text="message"></div>',mounted:function(){this.draw()},props:{ratio:{type:String},data:{type:Object},options:{type:Object},type:{type:String,required:!0,validator:function(t){return t==="Pie"||t==="Line"||t==="Bar"}},eventHandlers:{type:Array},responsiveOptions:{type:Array}},data:function(){return{chart:null,error:{onError:!1,message:""},noData:"",message:"",classNoData:this.options.classNoData}},methods:{clear:function(){this.noData="",this.message="",this.error.onError&&(this.error={onError:!1,message:""})},draw:function(){if(this.haveNoData())return this.setNoData();this.clear(),this.chart=new Chartist[this.type](this.$refs.chart,this.data,this.options,this.responsiveOptions),this.setEventHandlers()},haveNoData:function(){return!this.data||1>this.data.series.length||this.type!=="Pie"&&!this.options.distributeSeries&&(1>this.data.labels.length||this.data.series.every(function(t){return Array.isArray(t)?!t.length:!t.data.length}))},redraw:function(){if(this.error.onError)return this.draw();if(this.haveNoData())return this.setNoData();this.clear(),this.chart.update(this.data,this.options)},resetEventHandlers:function(t,e){var a=!0,i=!1,n,s;try{for(let r=e[Symbol.iterator](),h;!(a=(h=r.next()).done);a=!0){var o=h.value;this.chart.off(o.event,o.fn)}}catch(r){i=!0,n=r}finally{try{!a&&s.return&&s.return()}finally{if(i)throw n}}var l=!0,c=!1,f,u;try{for(let r=t[Symbol.iterator](),h;!(l=(h=r.next()).done);l=!0){var d=h.value;this.chart.on(d.event,d.fn)}}catch(r){c=!0,f=r}finally{try{!l&&u.return&&u.return()}finally{if(c)throw f}}},setEventHandlers:function(){if(this.eventHandlers){var t=!0,e=!1,a,i;try{for(let s=this.eventHandlers[Symbol.iterator](),o;!(t=(o=s.next()).done);t=!0){var n=o.value;this.chart.on(n.event,n.fn)}}catch(s){e=!0,a=s}finally{try{!t&&i.return&&i.return()}finally{if(e)throw a}}}},setNoData:function(){this.error={onError:!0,message:this.options.messageNoData},this.noData=this.classNoData,this.message=this.error.message}},watch:{ratio:"redraw",options:"draw",data:{handler:"redraw",deep:!0},type:"draw",eventHandlers:"resetEventHandlers"}}),Vue.prototype.pieOptions={showLabel:!1,plugins:[Chartist.plugins.legend({clickable:!1})]},Vue.prototype.lineOptions={showArea:!0,showPoint:!1,fullWidth:!0,showLabel:!1,axisX:{showGrid:!1,showLabel:!1,offset:0},chartPadding:0,low:0},Vue.prototype.barOptions={}})();
